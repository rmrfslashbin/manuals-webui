{{define "partials/user-list.html"}}
<div class="border-t border-gray-200 overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-300">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Name</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Capabilities</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Created</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Last Seen</th>
                <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                    <span class="sr-only">Actions</span>
                </th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
            {{range .Users}}
            <tr>
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">{{.Name}}</td>
                <td class="px-3 py-4 text-sm text-gray-500">
                    <div class="flex flex-wrap gap-1">
                        {{range .Capabilities}}
                        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium {{if eq . "*"}}bg-purple-100 text-purple-700{{else}}bg-blue-100 text-blue-700{{end}}">
                            {{.}}
                        </span>
                        {{else}}
                        <span class="text-gray-400 italic">none</span>
                        {{end}}
                    </div>
                </td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                    {{if .IsActive}}
                    <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-700">Active</span>
                    {{else}}
                    <span class="inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-700">Inactive</span>
                    {{end}}
                </td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{.CreatedAt}}</td>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{if .LastSeenAt}}{{.LastSeenAt}}{{else}}-{{end}}</td>
                <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
                    <button hx-post="/admin/users/{{.ID}}/rotate-key" hx-target="#user-list" hx-swap="innerHTML" hx-confirm="Are you sure you want to rotate this user's API key?" class="text-indigo-600 hover:text-indigo-900 mr-4">Rotate Key</button>
                    <button hx-delete="/admin/users/{{.ID}}" hx-target="#user-list" hx-swap="innerHTML" hx-confirm="Are you sure you want to delete this user?" class="text-red-600 hover:text-red-900">Delete</button>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="6" class="px-3 py-8 text-center text-sm text-gray-500">No users found</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

{{if .NewAPIKey}}
<script>
    document.getElementById('api-key-display').classList.remove('hidden');
    document.getElementById('new-api-key').textContent = '{{.NewAPIKey}}';
</script>
{{end}}
{{end}}
